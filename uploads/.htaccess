# Route direct file access through authenticated PHP endpoint
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Keep directories blocked (no folder browsing)
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [F,L]

    # Serve files only via secure endpoint (requires logged-in session)
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.+)$ ../api/secure_file.php?path=uploads/$1 [L,QSA]
</IfModule>

# Protect hidden files (Apache 2.2 + 2.4 compatible)
<FilesMatch "^\.">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Deny from all
    </IfModule>
</FilesMatch>
