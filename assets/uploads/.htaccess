# Disable directory listing
Options -Indexes

<IfModule mod_autoindex.c>
    IndexIgnore *
</IfModule>

# Route direct file access through authenticated PHP endpoint
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Block direct directory access
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [F,L]

    # Serve files only via secure endpoint (requires logged-in session)
    RewriteCond %{REQUEST_URI} ^/([^/]+)/assets/uploads/ [NC]
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.+)$ /%1/api/secure_file.php?path=assets/uploads/$1 [L,QSA]
</IfModule>

<FilesMatch "^\.">
    Require all denied
</FilesMatch>

